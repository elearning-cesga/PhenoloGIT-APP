{"version":3,"sources":["../../src/pages/profile/profile.module.ts","../../src/pages/profile/profile.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ProfilePage } from './profile';\n\n@NgModule({\n  declarations: [\n    ProfilePage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ProfilePage),\n  ],\n})\nexport class ProfilePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/profile/profile.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams,ToastController } from 'ionic-angular';\nimport { NativeStorage } from '@ionic-native/native-storage';\nimport { Camera, CameraOptions } from '@ionic-native/camera';\nimport { Events } from 'ionic-angular';\nimport { PhenoApi } from '../../providers/pheno-api/pheno-api';\nimport { FileTransfer, FileUploadOptions, FileTransferObject } from '@ionic-native/file-transfer';\n\n/**\n * Generated class for the ProfilePage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-profile',\n  templateUrl: 'profile.html',\n})\nexport class ProfilePage {\n\n  private user:any={};\n  private imageChanged:any;\n  private imageToUpload:any={media_url:''};\n  \n  constructor(\n    public navCtrl: NavController, \n    public navParams: NavParams,\n    public nativeStorage: NativeStorage,\n    private camera: Camera,\n    private phenoApi: PhenoApi,\n    private transfer: FileTransfer,\n    private events:Events,\n    private toastCtrl:ToastController\n  ) {\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad ProfilePage');\n    this.imageChanged=0;\n  }\n\n  ionViewWillLoad(){\n    console.log(\"checking user login before entering...\");\n    this.getUserFromStorage();\n  }\n\n  getUserFromStorage(){\n    console.log(\"getting user from storage\");\n    this.nativeStorage.getItem('user')\n    .then(\n      data => {\n        this.user=data;\n        console.log('got from storage: '+JSON.stringify(data));\n        if(this.user.username==null || this.user.username==undefined){\n          this.navCtrl.push('LoginPage',{destination:'ProfilePage'});\n        }\n      },\n      error => {\n        this.navCtrl.push('LoginPage',{destination:'ProfilePage'});\n        console.error(error)}\n    );\n  }\n\n  changeProfilePicture(){\n\n    const options: CameraOptions = {\n      quality: 100,\n      destinationType: this.camera.DestinationType.FILE_URI,\n        sourceType: this.camera.PictureSourceType.PHOTOLIBRARY,\n        correctOrientation: true,\n        mediaType: this.camera.MediaType.ALLMEDIA, //only pictures by now\n    }\n\n    this.camera.getPicture(options).then((imageData) => {\n\n      this.imageToUpload.media_url=imageData;\n      this.imageToUpload.media_prefix=Date.now();\n\n      this.user.picture=this.imageToUpload.media_url;\n      this.imageChanged=1;\n\n    }, (err) => {\n        console.log(err);\n    });\n\n  }\n\n  saveSettings(){\n   \n    console.log('saving settings');\n\n    if(this.imageToUpload.media_url!=''){\n      this.uploadProfilePicture(); //upload picture to /uploads/avatar/ in server\n      let fileName = this.imageToUpload.media_url.split(\"/\");\n      this.user.picture=this.imageToUpload.media_prefix+'_'+fileName.pop(); //file path formatting \n    }else{\n      console.log('not uploading image');\n    }\n\n    console.log(this.user);\n\n    //call to API to update user settings\n    this.phenoApi.updateUser(this.user).subscribe(\n        data => {console.log(\"response-> \"+data)},\n        err => {},\n        () => {\n          this.nativeStorage.setItem('user',{\n            username:this.user.username,\n            name:this.user.name,\n            lang:this.user.lang,\n            picture:this.user.picture,\n            id:this.user.id,\n            school:this.user.school,\n            type:this.user.type,\n            email:this.user.email\n          }).then(\n            () => {\n              console.log('Stored item!')\n              this.events.publish('user:update') //publish the login event\n            },\n            error => console.error('Error storing item', error)\n          );\n    \n          //present toast\n          this.presentToast('Profile updated successfully');\n          \n          //go to main page\n          this.navCtrl.setRoot('ObservationListPage');\n    \n        }\n      );\n\n      \n  }\n\n  presentToast(text) {\n    let toast = this.toastCtrl.create({\n      message: text,\n      duration: 3000,\n      position: 'bottom'\n    });\n  }\n\n   uploadProfilePicture() { //uploads file/s and resize in server\n\n     console.log('uploading picture...');\n\n      var fileURL = this.imageToUpload.media_url;\n      var prefix = this.imageToUpload.media_prefix;\n\n      var uri = encodeURI(\"http://web.phenologit.org/uploadMedia.php\"); //url of the server's php upload file\n      \n      var up_options : FileUploadOptions={\n        fileKey: 'bill',\n        fileName: fileURL.substr(fileURL.lastIndexOf('/')+1),\n        headers: headers,\n        mimeType : \"text/plain\",\n        params:params\n      };\n      \n      var params = {\n        'prefix':prefix,\n        'isAvatar':'true'\n      };\n   \n      up_options.params = params;\n\n      var headers = {'prefix':prefix,'isAvatar':'true'};\n      up_options.headers = headers;\n\n      var ft = new FileTransfer();\n      const fileTransfer: FileTransferObject = this.transfer.create();\n\n      var uri = encodeURI(\"http://web.phenologit.org/uploadMedia.php\");\n \n         fileTransfer.upload(fileURL, uri, up_options).then((data)=>{\n        console.log(data)\n      });\n\n      \n}\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/profile/profile.ts"],"sourceRoot":""}